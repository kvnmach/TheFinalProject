@using System.Data
@using Microsoft.AspNet.Identity
@using TheFinalProject.Models
@model TheFinalProject.Models.ProfileVm
@{
    ViewBag.Title = "Profile";
}


<div class="profile header">
    <div class="jumbotron">
        @if (Model.Email == User.Identity.Name)
        {
            <h1>
                Your Workshop
            </h1>
        }
        else
        {
            <h1> Welcome to</h1>
            <h1> @Model.Email</h1>
            <h1> Workshop</h1>
        }

    </div>
</div>

<div >
    <div class="row">

        <div class="profilesidebar textdiv">


            <h3>@Model.Email</h3>

            <h4>@Model.Phone</h4>
            <h4>@Model.City, @Model.State</h4>
            <h4>@Model.Zip</h4>

            @foreach (var item in Model.Following)
            {

                <tr>
                    <h3>
                        You Are Following
                    </h3>
                    <td>@Html.ActionLink($"{item.Email} ", "Profile", new { Id = item.UserId })</td>
                    <td><img style="width: 50px;" src="@item.Photo" /></td>
                    <td>
                        <div></div>
                    </td>
                    <td> <input type="button" data-id="@item.UserId" value="Unfollow" class="removeuser" /></td>
                </tr>
            }
        </div>
    </div>


  

        <div class="row">
            <div class="col-xs-6 profilepanel textdiv">

                @if (Model.Email == User.Identity.Name)
            {
                    @Html.ActionLink("Add a Tool", "CreateTool")

                }

                @foreach (var item in Model.MyTools)
            {

                    <tr>
                        <td>@item.Title</td>
                        <td><img style="width: 100px;" src="@item.Photo" /></td>
                        <td>
                            <div class="textdiv">@item.Description</div>
                        </td>
                        <td>@item.CategoryName</td>
                        <td>@item.ZipCode</td>



                        @if (item.UserId != User.Identity.GetUserId() && Model.Workbench.All(x => x.ToolId != item.ToolId))
                {
                            <td> <input type="button" data-id="@item.ToolId" value="Add to Workbench" class="addtool" /></td>
                        }
                        @if (Model.Workbench.Any(x => x.ToolId == item.ToolId))
                {
                            <td>In Workbench</td>
                        }
                    </tr>
                    <tr>
                        <td></td>
                        <td></td>
                        @if (item.UserId == User.Identity.GetUserId())
                {
                            <td>@Html.ActionLink("Edit Tool ", "EditTool", new { Id = item.ToolId })</td>
                            <td>@Html.ActionLink("Delete Tool", "DeleteTool", new { Id = item.ToolId })</td>
                        }

                    </tr>
                }

            </div>

        </div>
        <div class="row">
            <div class="workbench">
                <table>
                    <tr>
                        <div>
                            <h1>Your WorkBench</h1>
                        </div>
                    </tr>
                    @foreach (var item in Model.Workbench)
            {
                        <tr>
                            <td>@item.Title</td>
                            <td><img style="width: 58px;" src="@item.Photo" /></td>
                            <td>
                                @Html.ActionLink($"{item.UserEmail} ", "Profile", new { Id = item.UserId })
                            </td>
                            <td class="button"><a href="#"> <input type="button" data-id="@item.ToolId" value="Remove" class="removetool"/></a></td>
                        </tr>
                    }
                </table>
            </div>
        </div>
    </div>











    @section scripts{
        <script>

            $(".removetool")
                .click(function () {
                    var id = $(this).data('id');
                    $.ajax({
                        type: "POST",
                        data: { id: id },
                        url: '@Url.Action("RemoveWorkBench", "Home")'
                    })
                        .done(function () {
                            location.reload(true);
                        });

                });
            $(".addtool")
                .click(function () {
                    var id = $(this).data('id');
                    $.ajax({
                        type: "POST",
                        data: { id: id },
                        url: '@Url.Action("AddWorkbench", "Home")'
                    })
                        .done(function () {
                            location.reload(true);
                        });

                });

            $(".removeuser")
              .click(function () {
                  var id = $(this).data('id');
                  $.ajax({
                      type: "POST",
                      data: { id: id },
                      url: '@Url.Action("RemoveFollowing", "Home")'
                  })
                      .done(function () {
                          location.reload(true);
                      });

              });

            $(".adduser")
        .click(function () {
            var id = $(this).data('id');
            $.ajax({
                type: "POST",
                data: { id: id },
                url: '@Url.Action("AddtoFollowing", "Home")'
            })
                .done(function () {
                    location.reload(true);
                });

        });

        </script>
    }
